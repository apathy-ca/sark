# ============================================================================
# SARK UI - Security Headers Configuration
# ============================================================================
# This file defines security headers to protect against common web vulnerabilities
# Reference: https://owasp.org/www-project-secure-headers/
# ============================================================================

# Prevent clickjacking attacks
# Only allow this site to frame itself (useful for embedded dashboards)
add_header X-Frame-Options "SAMEORIGIN" always;

# Prevent MIME type sniffing
# Force browsers to respect declared Content-Type
add_header X-Content-Type-Options "nosniff" always;

# Enable XSS filter in older browsers
# Modern browsers have this enabled by default
add_header X-XSS-Protection "1; mode=block" always;

# Control referrer information
# Send full URL for same-origin, only origin for cross-origin
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Content Security Policy (CSP)
# Restrict resources the page can load to prevent XSS attacks
# Note: Adjust 'unsafe-inline' and 'unsafe-eval' based on your needs
# For production, remove 'unsafe-inline' and use nonce/hash-based CSP
add_header Content-Security-Policy "
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' data: https://fonts.gstatic.com;
    img-src 'self' data: https: blob:;
    connect-src 'self' http://app:8000 https://app:8000;
    frame-ancestors 'self';
    base-uri 'self';
    form-action 'self';
    upgrade-insecure-requests;
" always;

# Permissions Policy (formerly Feature Policy)
# Control which browser features can be used
add_header Permissions-Policy "
    accelerometer=(),
    ambient-light-sensor=(),
    autoplay=(),
    battery=(),
    camera=(),
    cross-origin-isolated=(),
    display-capture=(),
    document-domain=(),
    encrypted-media=(),
    execution-while-not-rendered=(),
    execution-while-out-of-viewport=(),
    fullscreen=(self),
    geolocation=(),
    gyroscope=(),
    keyboard-map=(),
    magnetometer=(),
    microphone=(),
    midi=(),
    navigation-override=(),
    payment=(),
    picture-in-picture=(),
    publickey-credentials-get=(),
    screen-wake-lock=(),
    sync-xhr=(),
    usb=(),
    web-share=(),
    xr-spatial-tracking=()
" always;

# Strict Transport Security (HSTS)
# Force HTTPS connections for 1 year
# Uncomment when using HTTPS in production
# add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# Prevent browsers from performing DNS prefetching
# Uncomment if you want to prevent potential privacy leaks
# add_header X-DNS-Prefetch-Control "off" always;

# Clear-Site-Data header
# Used to clear browser data on logout
# This is application-specific and should be added by the API on logout
# add_header Clear-Site-Data "\"cache\", \"cookies\", \"storage\", \"executionContexts\"" always;

# ============================================================================
# Notes on Security Headers
# ============================================================================
#
# 1. Content-Security-Policy (CSP):
#    - Adjust based on your application's needs
#    - For production, use nonce or hash-based CSP instead of 'unsafe-inline'
#    - Monitor CSP violations using report-uri directive
#
# 2. connect-src:
#    - Update with your actual API domain in production
#    - Remove localhost entries for production
#
# 3. HSTS:
#    - Only enable after confirming HTTPS works correctly
#    - includeSubDomains affects all subdomains
#    - preload submits your site to browser HSTS preload list
#
# 4. Testing:
#    - Use https://securityheaders.com to test your headers
#    - Use https://csp-evaluator.withgoogle.com to evaluate CSP
#
# 5. Performance:
#    - These headers are sent with every response
#    - Minimal performance impact (<1KB per response)
#
# ============================================================================
