# ============================================================================
# SARK Frontend - Development Dockerfile
# ============================================================================
# This Dockerfile is optimized for local development with:
# - Hot module replacement (HMR)
# - Fast startup time
# - Volume-mounted source code
# - Vite dev server
# ============================================================================

FROM node:18-alpine

# Install additional tools for development
RUN apk add --no-cache \
    git \
    bash \
    curl

# Set working directory
WORKDIR /app

# Copy package files first (for better layer caching)
COPY package*.json ./

# Install ALL dependencies (including devDependencies)
RUN npm ci

# Copy the rest of the application
# Note: In docker-compose, source will be volume-mounted for hot-reload
COPY . .

# Expose Vite dev server port
EXPOSE 5173

# Set environment to development
ENV NODE_ENV=development

# Enable polling for file watching (needed in Docker)
ENV CHOKIDAR_USEPOLLING=true

# Health check for dev server
HEALTHCHECK --interval=10s --timeout=3s --start-period=30s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://localhost:5173/ || exit 1

# Start Vite dev server
# --host 0.0.0.0 allows external connections (required for Docker)
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
