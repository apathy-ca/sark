
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Enterprise-Grade MCP Governance System">
      
      
        <meta name="author" content="James Henry">
      
      
        <link rel="canonical" href="https://sark.example.com/troubleshooting/gateway/FAQ/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>SARK Gateway Integration - Frequently Asked Questions (FAQ) - SARK - Security Audit and Resource Kontroler</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sark-gateway-integration-frequently-asked-questions-faq" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="SARK - Security Audit and Resource Kontroler" class="md-header__button md-logo" aria-label="SARK - Security Audit and Resource Kontroler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SARK - Security Audit and Resource Kontroler
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SARK Gateway Integration - Frequently Asked Questions (FAQ)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/apathy-ca/sark" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    apathy-ca/sark
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../QUICK_START/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ARCHITECTURE/" class="md-tabs__link">
          
  
  
    
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../DEPLOYMENT/" class="md-tabs__link">
          
  
  
    
  
  Deployment

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../AUTHENTICATION/" class="md-tabs__link">
          
  
  
    
  
  Authentication & Authorization

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../OPA_POLICY_GUIDE/" class="md-tabs__link">
          
  
  
    
  
  Policies

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../MONITORING/" class="md-tabs__link">
          
  
  
    
  
  Operations

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../DATABASE_MIGRATIONS/" class="md-tabs__link">
          
  
  
    
  
  Database

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../PERFORMANCE_TESTING/" class="md-tabs__link">
          
  
  
    
  
  Performance

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../API_REFERENCE/" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../DEVELOPMENT/" class="md-tabs__link">
          
  
  
    
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../EXECUTIVE_SUMMARY/" class="md-tabs__link">
          
  
  
    
  
  Reports

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../REPOSITORY_IMPROVEMENT_PLAN/" class="md-tabs__link">
          
  
  
    
  
  Planning

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../GLOSSARY/" class="md-tabs__link">
          
  
  
    
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="SARK - Security Audit and Resource Kontroler" class="md-nav__button md-logo" aria-label="SARK - Security Audit and Resource Kontroler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    SARK - Security Audit and Resource Kontroler
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/apathy-ca/sark" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    apathy-ca/sark
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../QUICK_START/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../QUICK_REFERENCE_SESSIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PERFORMANCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DEPLOYMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DOCKER_DEPLOYMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PRODUCTION_DEPLOYMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PRODUCTION_CONFIG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production Config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PRODUCTION_READINESS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production Readiness
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DEPLOYMENT_CHECKLIST/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment Checklist
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DISASTER_RECOVERY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Disaster Recovery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ROLLBACK_PROCEDURES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rollback Procedures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Authentication & Authorization
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Authentication & Authorization
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AUTHENTICATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../AUTHORIZATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authorization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OIDC_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OIDC Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LDAP_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LDAP Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SAML_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SAML Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../API_KEYS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Keys
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Policies
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Policies
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OPA_POLICY_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OPA Policy Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ADVANCED_OPA_POLICIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Advanced OPA Policies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../POLICY_OPTIMIZATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../POLICY_CACHING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Caching
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../POLICY_AUDIT_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Audit Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../POLICY_AUDIT_TRAIL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Audit Trail
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operations
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../MONITORING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../MONITORING_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OPERATIONAL_RUNBOOK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operational Runbook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../OPERATIONS_RUNBOOK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operations Runbook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../INCIDENT_RESPONSE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Incident Response
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../TROUBLESHOOTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Database
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DATABASE_MIGRATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Migrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DATABASE_OPTIMIZATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../REDIS_OPTIMIZATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Redis Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Performance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Performance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PERFORMANCE_TESTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PERFORMANCE_TUNING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Tuning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PERFORMANCE_OPTIMIZATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PERFORMANCE_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../POLICY_PERFORMANCE_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../API_REFERENCE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../API_INTEGRATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DEVELOPMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../MIGRATION_GUIDE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Migration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DEVELOPMENT_LOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development Log
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../TESTING_STRATEGY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../INTEGRATION_TESTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reports
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reports
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../EXECUTIVE_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Executive Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../IMPLEMENTATION_PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Implementation Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../GAP_ANALYSIS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gap Analysis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PHASE2_COMPLETION_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 2 Completion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../RELEASE_NOTES_v0.2.0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Notes v0.2.0
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../FINAL_TEST_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Final Test Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../TEST_COVERAGE_REPORT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test Coverage Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../KNOWN_ISSUES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Known Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../LESSONS_LEARNED/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lessons Learned
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Planning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    Planning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../REPOSITORY_IMPROVEMENT_PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repository Improvement Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../WORK_BREAKDOWN_SESSIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Work Breakdown Sessions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../WORK_TASKS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Work Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PHASE2_3WEEK_PLAN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 2 3-Week Plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../WEEK_2_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Week 2 Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../WEEK_3_SUMMARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Week 3 Summary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../GLOSSARY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../FAQ/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SECURITY_BEST_PRACTICES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Best Practices
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SECURITY_HARDENING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Hardening
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SECURITY_AUDIT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PRODUCTION_HANDOFF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production Handoff
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-installation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup &amp; Installation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup &amp; Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q1-how-do-i-enable-gateway-integration-in-sark" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q1: How do I enable Gateway integration in SARK?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q2-what-are-the-minimum-system-requirements-for-gateway-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q2: What are the minimum system requirements for Gateway integration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q3-can-i-run-sark-and-gateway-on-the-same-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q3: Can I run SARK and Gateway on the same server?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q4-how-do-i-generate-a-gateway-api-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q4: How do I generate a Gateway API key?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q5-what-happens-if-i-deploy-sark-without-configuring-gateway-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q5: What happens if I deploy SARK without configuring Gateway integration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q6-can-i-migrate-existing-sark-deployments-to-use-gateway-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q6: Can I migrate existing SARK deployments to use Gateway integration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q7-what-opa-policies-do-i-need-for-gateway-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q7: What OPA policies do I need for Gateway integration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q8-how-do-i-test-gateway-integration-locally" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q8: How do I test Gateway integration locally?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q9-do-i-need-to-modify-my-existing-mcp-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q9: Do I need to modify my existing MCP servers?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q10-can-i-use-gateway-integration-with-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q10: Can I use Gateway integration with Kubernetes?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q11-how-do-i-upgrade-sark-with-gateway-integration-enabled" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q11: How do I upgrade SARK with Gateway integration enabled?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-operations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Usage &amp; Operations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage &amp; Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q12-how-do-i-authorize-a-gateway-request" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q12: How do I authorize a Gateway request?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q13-what-actions-can-be-authorized-through-gateway-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q13: What actions can be authorized through Gateway integration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q14-how-do-i-view-gateway-authorization-audit-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q14: How do I view Gateway authorization audit logs?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q15-can-i-override-authorization-decisions-manually" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q15: Can I override authorization decisions manually?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q16-how-do-i-handle-gateway-failover-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q16: How do I handle Gateway failover scenarios?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q17-what-metrics-should-i-monitor-for-gateway-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q17: What metrics should I monitor for Gateway integration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q18-how-do-i-debug-why-a-request-was-denied" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q18: How do I debug why a request was denied?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q19-can-i-batch-authorize-multiple-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q19: Can I batch authorize multiple requests?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q20-how-do-i-rotate-gateway-api-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q20: How do I rotate Gateway API keys?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q21-what-happens-if-opa-is-unavailable" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q21: What happens if OPA is unavailable?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#policies-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Policies &amp; Authorization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Policies &amp; Authorization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q22-how-do-i-write-a-custom-gateway-authorization-policy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q22: How do I write a custom Gateway authorization policy?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q23-whats-the-difference-between-sark-policies-and-gateway-policies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q23: What's the difference between SARK policies and Gateway policies?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q24-how-do-i-grant-a-user-access-to-specific-gateway-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q24: How do I grant a user access to specific Gateway servers?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q25-can-i-filter-sensitive-parameters-in-gateway-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q25: Can I filter sensitive parameters in Gateway requests?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q26-how-do-i-implement-time-based-access-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q26: How do I implement time-based access restrictions?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q27-what-are-sensitivity-levels-and-how-do-they-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q27: What are sensitivity levels and how do they work?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q28-how-do-i-handle-a2a-agent-to-agent-authorization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q28: How do I handle A2A (agent-to-agent) authorization?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q29-can-i-test-policies-without-deploying-to-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q29: Can I test policies without deploying to production?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q30-how-do-i-implement-rate-limiting-per-user" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q30: How do I implement rate limiting per user?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q31-what-happens-when-policies-conflict" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q31: What happens when policies conflict?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-scaling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance &amp; Scaling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance &amp; Scaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q32-what-is-the-expected-latency-for-authorization-requests" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q32: What is the expected latency for authorization requests?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q33-how-do-i-optimize-cache-hit-rates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q33: How do I optimize cache hit rates?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q34-how-many-requests-per-second-can-sark-handle" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q34: How many requests per second can SARK handle?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q35-how-do-i-scale-sark-for-high-traffic-gateway-deployments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q35: How do I scale SARK for high-traffic Gateway deployments?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q36-should-i-use-redis-cluster-or-redis-sentinel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q36: Should I use Redis Cluster or Redis Sentinel?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q37-how-do-i-reduce-database-load-from-audit-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q37: How do I reduce database load from audit logs?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q38-what-are-the-performance-implications-of-complex-opa-policies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q38: What are the performance implications of complex OPA policies?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q39-how-do-i-monitor-gateway-integration-performance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q39: How do I monitor Gateway integration performance?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q40-can-i-use-cdn-caching-for-gateway-responses" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q40: Can I use CDN caching for Gateway responses?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security &amp; Authentication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security &amp; Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q41-how-are-gateway-api-keys-secured" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q41: How are Gateway API keys secured?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q42-what-authentication-methods-are-supported" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q42: What authentication methods are supported?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q43-how-do-i-implement-zero-trust-security-for-gateway-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q43: How do I implement zero-trust security for Gateway integration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q44-how-are-secrets-managed-in-gateway-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q44: How are secrets managed in Gateway integration?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q45-what-security-headers-should-be-configured" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q45: What security headers should be configured?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q46-how-do-i-prevent-replay-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q46: How do I prevent replay attacks?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q47-how-are-audit-logs-protected-from-tampering" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q47: How are audit logs protected from tampering?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q48-what-compliance-standards-does-gateway-integration-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q48: What compliance standards does Gateway integration support?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q49-how-do-i-implement-ip-allowlisting-for-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q49: How do I implement IP allowlisting for Gateway?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q50-how-do-i-audit-who-accessed-sensitive-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q50: How do I audit who accessed sensitive data?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-compatibility" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration &amp; Compatibility
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration &amp; Compatibility">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q51-is-gateway-integration-compatible-with-existing-mcp-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q51: Is Gateway integration compatible with existing MCP servers?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q52-can-i-use-gateway-integration-with-claude-desktop" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q52: Can I use Gateway integration with Claude Desktop?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q53-does-gateway-integration-work-with-kubernetes-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q53: Does Gateway integration work with Kubernetes Ingress?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-debugging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting &amp; Debugging
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting &amp; Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#q54-why-are-my-authorization-requests-timing-out" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q54: Why are my authorization requests timing out?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q55-how-do-i-enable-debug-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q55: How do I enable debug logging?
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#q56-where-can-i-find-help-and-support" class="md-nav__link">
    <span class="md-ellipsis">
      
        Q56: Where can I find help and support?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Additional Resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="sark-gateway-integration-frequently-asked-questions-faq">SARK Gateway Integration - Frequently Asked Questions (FAQ)<a class="headerlink" href="#sark-gateway-integration-frequently-asked-questions-faq" title="Permanent link">&para;</a></h1>
<p><strong>Version</strong>: 1.1.0
<strong>Last Updated</strong>: November 2025
<strong>Audience</strong>: Developers, Operations Engineers, End Users</p>
<hr />
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="#setup--installation">Setup &amp; Installation</a></li>
<li><a href="#usage--operations">Usage &amp; Operations</a></li>
<li><a href="#policies--authorization">Policies &amp; Authorization</a></li>
<li><a href="#performance--scaling">Performance &amp; Scaling</a></li>
<li><a href="#security--authentication">Security &amp; Authentication</a></li>
<li><a href="#integration--compatibility">Integration &amp; Compatibility</a></li>
<li><a href="#troubleshooting--debugging">Troubleshooting &amp; Debugging</a></li>
</ol>
<hr />
<h2 id="setup-installation">Setup &amp; Installation<a class="headerlink" href="#setup-installation" title="Permanent link">&para;</a></h2>
<h3 id="q1-how-do-i-enable-gateway-integration-in-sark">Q1: How do I enable Gateway integration in SARK?<a class="headerlink" href="#q1-how-do-i-enable-gateway-integration-in-sark" title="Permanent link">&para;</a></h3>
<p><strong>This is one of the most common setup questions.</strong></p>
<p><strong>A:</strong> Add the following to your <code>.env</code> file and restart SARK:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Enable Gateway Integration</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nv">GATEWAY_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nv">GATEWAY_URL</span><span class="o">=</span>http://gateway:8080
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nv">GATEWAY_API_KEY</span><span class="o">=</span>your-api-key-here
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nv">GATEWAY_TIMEOUT_SECONDS</span><span class="o">=</span><span class="m">10</span>.0
</span></code></pre></div>
<p>Then restart:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>restart<span class="w"> </span>sark
</span></code></pre></div></p>
<p>Verify it's enabled:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>curl<span class="w"> </span>http://localhost:8000/api/v1/version<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.features.gateway_integration&#39;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="c1"># Should return: true</span>
</span></code></pre></div></p>
<p><strong> Learn more:</strong> <a href="../../../MCP_GATEWAY_INTEGRATION_PLAN/">Gateway Integration Plan</a></p>
<hr />
<h3 id="q2-what-are-the-minimum-system-requirements-for-gateway-integration">Q2: What are the minimum system requirements for Gateway integration?<a class="headerlink" href="#q2-what-are-the-minimum-system-requirements-for-gateway-integration" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> The Gateway integration adds minimal overhead to SARK:</p>
<p><strong>Minimum Requirements:</strong>
- <strong>CPU</strong>: +1 vCPU (total 3 vCPU recommended)
- <strong>Memory</strong>: +512 MB RAM (total 2 GB recommended)
- <strong>Network</strong>: 100 Mbps with &lt;10ms latency to Gateway
- <strong>Storage</strong>: +5 GB for audit logs</p>
<p><strong>Recommended for Production:</strong>
- <strong>CPU</strong>: 4-8 vCPUs
- <strong>Memory</strong>: 4-8 GB RAM
- <strong>Network</strong>: 1 Gbps with &lt;5ms latency
- <strong>Storage</strong>: 50+ GB with SSD</p>
<p><strong>Why this matters:</strong> Gateway integration performs authorization checks on every request, so adequate resources ensure &lt;50ms authorization latency.</p>
<hr />
<h3 id="q3-can-i-run-sark-and-gateway-on-the-same-server">Q3: Can I run SARK and Gateway on the same server?<a class="headerlink" href="#q3-can-i-run-sark-and-gateway-on-the-same-server" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Yes, but it's not recommended for production.</p>
<p><strong>Development/Testing:</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># docker-compose.gateway.yml</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nt">sark</span><span class="p">:</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8000:8000&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="nt">gateway</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">  </span><span class="c1"># They can share Redis, PostgreSQL, OPA</span>
</span></code></pre></div></p>
<p><strong>Production:</strong>
- Run SARK and Gateway on separate infrastructure
- Use service mesh (Istio, Linkerd) for secure communication
- Implement proper network isolation and firewalls</p>
<p><strong>Why separate?</strong> Fault isolation, independent scaling, and security boundaries.</p>
<hr />
<h3 id="q4-how-do-i-generate-a-gateway-api-key">Q4: How do I generate a Gateway API key?<a class="headerlink" href="#q4-how-do-i-generate-a-gateway-api-key" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use the SARK CLI to generate a secure API key:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Generate new Gateway API key</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>sark-app<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>sark.cli<span class="w"> </span>generate-api-key<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span>--type<span class="w"> </span>gateway<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;production-gateway&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span>--expires-days<span class="w"> </span><span class="m">365</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># Output:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="c1"># API Key: gw_sk_live_abc123def456...</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="c1"># Store this securely - it won&#39;t be shown again!</span>
</span></code></pre></div>
<p>Store it in your <code>.env</code> file:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nv">GATEWAY_API_KEY</span><span class="o">=</span>gw_sk_live_abc123def456...
</span></code></pre></div></p>
<p><strong>Security tip:</strong> Rotate API keys every 90-180 days and use different keys for dev/staging/prod.</p>
<hr />
<h3 id="q5-what-happens-if-i-deploy-sark-without-configuring-gateway-integration">Q5: What happens if I deploy SARK without configuring Gateway integration?<a class="headerlink" href="#q5-what-happens-if-i-deploy-sark-without-configuring-gateway-integration" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> SARK will work normally, but Gateway integration features will be disabled:</p>
<ul>
<li> <strong>Still works</strong>: All standard SARK features (auth, policies, audit)</li>
<li> <strong>Won't work</strong>: Gateway authorization endpoints return 404</li>
<li> <strong>Warning</strong>: Logs will show "Gateway integration disabled" messages</li>
</ul>
<p>You can enable it anytime by adding configuration and restarting.</p>
<hr />
<h3 id="q6-can-i-migrate-existing-sark-deployments-to-use-gateway-integration">Q6: Can I migrate existing SARK deployments to use Gateway integration?<a class="headerlink" href="#q6-can-i-migrate-existing-sark-deployments-to-use-gateway-integration" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Yes! Gateway integration is backward-compatible.</p>
<p><strong>Migration Steps:</strong></p>
<ol>
<li><strong>Update configuration</strong> (add Gateway variables to <code>.env</code>)</li>
<li><strong>Deploy OPA policies</strong> for Gateway authorization</li>
<li><strong>Restart SARK</strong> (zero-downtime with rolling restart)</li>
<li><strong>Verify health</strong> (<code>/health/detailed</code> should show Gateway connectivity)</li>
<li><strong>Configure Gateway</strong> to call SARK authorization endpoint</li>
<li><strong>Test authorization flow</strong> with sample requests</li>
<li><strong>Monitor metrics</strong> for the first 24 hours</li>
</ol>
<p><strong>Rollback:</strong> Simply set <code>GATEWAY_ENABLED=false</code> and restart.</p>
<p><strong> Migration guide:</strong> <a href="../../../OPERATIONS_RUNBOOK/#migration-procedures">OPERATIONS_RUNBOOK.md</a></p>
<hr />
<h3 id="q7-what-opa-policies-do-i-need-for-gateway-integration">Q7: What OPA policies do I need for Gateway integration?<a class="headerlink" href="#q7-what-opa-policies-do-i-need-for-gateway-integration" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> The minimum policy set includes:</p>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># opa/policies/gateway_authorization.rego</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">package</span><span class="w"> </span><span class="n">mcp</span><span class="p">.</span><span class="n">gateway</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="k">default</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">false</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="c1"># Basic tool invocation</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">role</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;developer&quot;</span><span class="p">]</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">sensitivity_level</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">]</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Pre-built policies</strong> are included in <code>opa/policies/gateway_*.rego</code>.</p>
<p><strong> Learn more:</strong> <a href="../../../ADVANCED_OPA_POLICIES/">ADVANCED_OPA_POLICIES.md</a></p>
<hr />
<h3 id="q8-how-do-i-test-gateway-integration-locally">Q8: How do I test Gateway integration locally?<a class="headerlink" href="#q8-how-do-i-test-gateway-integration-locally" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use the included Docker Compose setup:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># 1. Start all services</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="c1"># 2. Check health</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>curl<span class="w"> </span>http://localhost:8000/health/detailed<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="c1"># 3. Test authorization</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/v1/gateway/authorize<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="k">$(</span>cat<span class="w"> </span>test_token.txt<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="s1">    &quot;action&quot;: &quot;gateway:tool:invoke&quot;,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="s1">    &quot;server_name&quot;: &quot;test-server&quot;,</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="s1">    &quot;tool_name&quot;: &quot;read-file&quot;</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="s1">  }&#39;</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="c1"># Expected: {&quot;allow&quot;: true, &quot;reason&quot;: &quot;...&quot;, ...}</span>
</span></code></pre></div>
<p><strong> Testing guide:</strong> <a href="../../../INTEGRATION_TESTING/">INTEGRATION_TESTING.md</a></p>
<hr />
<h3 id="q9-do-i-need-to-modify-my-existing-mcp-servers">Q9: Do I need to modify my existing MCP servers?<a class="headerlink" href="#q9-do-i-need-to-modify-my-existing-mcp-servers" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> No! MCP servers don't need any modifications.</p>
<p><strong>How it works:</strong>
1. Gateway receives request from client
2. Gateway calls SARK for authorization
3. SARK evaluates policies and returns decision
4. Gateway forwards approved requests to MCP server
5. MCP server processes request normally</p>
<p>MCP servers are unaware of the authorization layer.</p>
<hr />
<h3 id="q10-can-i-use-gateway-integration-with-kubernetes">Q10: Can I use Gateway integration with Kubernetes?<a class="headerlink" href="#q10-can-i-use-gateway-integration-with-kubernetes" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Yes! Kubernetes is fully supported.</p>
<p><strong>Quick deployment:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Apply Gateway-enabled SARK deployment</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>k8s/gateway-integration/
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># Verify pods</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>sark<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sark-gateway
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># Check logs</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>sark<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>sark-gateway<span class="w"> </span>--tail<span class="o">=</span><span class="m">100</span>
</span></code></pre></div></p>
<p><strong> Kubernetes guide:</strong> <a href="../../../deployment/KUBERNETES/">deployment/KUBERNETES.md</a></p>
<hr />
<h3 id="q11-how-do-i-upgrade-sark-with-gateway-integration-enabled">Q11: How do I upgrade SARK with Gateway integration enabled?<a class="headerlink" href="#q11-how-do-i-upgrade-sark-with-gateway-integration-enabled" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use rolling updates to ensure zero downtime:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># 1. Pull latest image</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>pull<span class="w"> </span>sark
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># 2. Update with zero downtime</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--no-deps<span class="w"> </span>--scale<span class="w"> </span><span class="nv">sark</span><span class="o">=</span><span class="m">2</span><span class="w"> </span>sark
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="c1"># 3. Wait for health check</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>sleep<span class="w"> </span><span class="m">30</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="c1"># 4. Remove old container</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--no-deps<span class="w"> </span>--scale<span class="w"> </span><span class="nv">sark</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>sark
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="c1"># 5. Verify</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>curl<span class="w"> </span>http://localhost:8000/api/v1/version<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.version&#39;</span>
</span></code></pre></div>
<p><strong>Kubernetes:</strong> Use <code>kubectl rollout</code> for automated rolling updates.</p>
<hr />
<h2 id="usage-operations">Usage &amp; Operations<a class="headerlink" href="#usage-operations" title="Permanent link">&para;</a></h2>
<h3 id="q12-how-do-i-authorize-a-gateway-request">Q12: How do I authorize a Gateway request?<a class="headerlink" href="#q12-how-do-i-authorize-a-gateway-request" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Gateway calls SARK's authorization endpoint:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/v1/gateway/authorize<span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">USER_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="s1">    &quot;action&quot;: &quot;gateway:tool:invoke&quot;,</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="s1">    &quot;server_name&quot;: &quot;postgres-mcp&quot;,</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="s1">    &quot;tool_name&quot;: &quot;execute_query&quot;,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="s1">    &quot;parameters&quot;: {</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="s1">      &quot;query&quot;: &quot;SELECT * FROM users&quot;,</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="s1">      &quot;database&quot;: &quot;production&quot;</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="s1">    }</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="s1">  }&#39;</span>
</span></code></pre></div>
<p><strong>Response (allowed):</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="nt">&quot;allow&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">  </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;User has developer role with access to medium-sensitivity tools&quot;</span><span class="p">,</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nt">&quot;filtered_parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="nt">&quot;query&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM users&quot;</span><span class="p">,</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">  </span><span class="nt">&quot;audit_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;aud_abc123&quot;</span><span class="p">,</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">  </span><span class="nt">&quot;cache_ttl&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong> API Reference:</strong> <a href="../../../API_REFERENCE/#gateway-authorization">API_REFERENCE.md</a></p>
<hr />
<h3 id="q13-what-actions-can-be-authorized-through-gateway-integration">Q13: What actions can be authorized through Gateway integration?<a class="headerlink" href="#q13-what-actions-can-be-authorized-through-gateway-integration" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> SARK supports these Gateway actions:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Description</th>
<th>Example Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gateway:tool:invoke</code></td>
<td>Authorize tool execution</td>
<td>Execute database query</td>
</tr>
<tr>
<td><code>gateway:tool:discover</code></td>
<td>Authorize tool discovery</td>
<td>List available tools</td>
</tr>
<tr>
<td><code>gateway:server:list</code></td>
<td>Authorize server listing</td>
<td>View registered servers</td>
</tr>
<tr>
<td><code>gateway:server:info</code></td>
<td>Authorize server details</td>
<td>Get server metadata</td>
</tr>
<tr>
<td><code>a2a:communicate</code></td>
<td>Agent-to-agent communication</td>
<td>Agent requests capability from another agent</td>
</tr>
</tbody>
</table>
<p>Each action has specific policy rules in OPA.</p>
<hr />
<h3 id="q14-how-do-i-view-gateway-authorization-audit-logs">Q14: How do I view Gateway authorization audit logs?<a class="headerlink" href="#q14-how-do-i-view-gateway-authorization-audit-logs" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Audit logs are stored in PostgreSQL and can be queried via API:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># Get recent Gateway authorization events</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>curl<span class="w"> </span>http://localhost:8000/api/v1/audit/events<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">ADMIN_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">  </span>-G<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">  </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;event_type=gateway:tool:invoke&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">  </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;limit=100&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.events[] | {timestamp, user, decision, tool}&#39;</span>
</span></code></pre></div>
<p><strong>Direct database query:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">SELECT</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="k">timestamp</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="n">user_id</span><span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="n">event_type</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="n">decision</span><span class="p">,</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">  </span><span class="n">metadata</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;server_name&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">server</span><span class="p">,</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">  </span><span class="n">metadata</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;tool_name&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tool</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">audit_events</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">event_type</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;gateway:%&#39;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">DESC</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span></code></pre></div></p>
<p><strong> Audit guide:</strong> <a href="../../../POLICY_AUDIT_TRAIL/">POLICY_AUDIT_TRAIL.md</a></p>
<hr />
<h3 id="q15-can-i-override-authorization-decisions-manually">Q15: Can I override authorization decisions manually?<a class="headerlink" href="#q15-can-i-override-authorization-decisions-manually" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Not directly, but you can temporarily modify policies:</p>
<p><strong>Option 1: Emergency override policy</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Add to OPA policies</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;emergency-admin&quot;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">override_reason</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Option 2: Update user roles/permissions</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Grant temporary admin access</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>PATCH<span class="w"> </span>http://localhost:8000/api/v1/users/user_123<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">ADMIN_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;role&quot;: &quot;admin&quot;}&#39;</span>
</span></code></pre></div></p>
<p><strong>Best practice:</strong> Use time-limited role assignments with audit logging.</p>
<hr />
<h3 id="q16-how-do-i-handle-gateway-failover-scenarios">Q16: How do I handle Gateway failover scenarios?<a class="headerlink" href="#q16-how-do-i-handle-gateway-failover-scenarios" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> SARK includes built-in resilience:</p>
<p><strong>Circuit Breaker:</strong>
- After 5 consecutive Gateway failures, circuit opens
- Requests fast-fail for 30 seconds
- Half-open state tries 1 request after timeout
- Auto-recovery when Gateway is healthy</p>
<p><strong>Configuration:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nv">GATEWAY_CIRCUIT_BREAKER_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nv">GATEWAY_CIRCUIT_BREAKER_THRESHOLD</span><span class="o">=</span><span class="m">5</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nv">GATEWAY_CIRCUIT_BREAKER_TIMEOUT</span><span class="o">=</span><span class="m">30</span>
</span></code></pre></div></p>
<p><strong>Monitoring:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># Check circuit breaker status</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>curl<span class="w"> </span>http://localhost:8000/api/v1/gateway/health<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.circuit_breaker&#39;</span>
</span></code></pre></div></p>
<p><strong> Reliability guide:</strong> <a href="../../../OPERATIONS_RUNBOOK/#failover-procedures">OPERATIONS_RUNBOOK.md</a></p>
<hr />
<h3 id="q17-what-metrics-should-i-monitor-for-gateway-integration">Q17: What metrics should I monitor for Gateway integration?<a class="headerlink" href="#q17-what-metrics-should-i-monitor-for-gateway-integration" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Key metrics to track:</p>
<p><strong>Authorization Performance:</strong>
- <code>sark_gateway_authz_latency_seconds</code> (P50, P95, P99)
- <code>sark_gateway_authz_requests_total</code> (by decision: allow/deny)
- <code>sark_gateway_cache_hit_rate</code></p>
<p><strong>Gateway Health:</strong>
- <code>sark_gateway_connection_errors_total</code>
- <code>sark_gateway_timeout_errors_total</code>
- <code>sark_gateway_circuit_breaker_state</code></p>
<p><strong>Grafana Dashboard:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Import pre-built dashboard</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>curl<span class="w"> </span>http://localhost:3000/api/dashboards/db<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">  </span>-u<span class="w"> </span>admin:admin<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span>-d<span class="w"> </span>@dashboards/gateway-integration.json
</span></code></pre></div></p>
<p><strong> Monitoring guide:</strong> <a href="../../../MONITORING/">MONITORING.md</a></p>
<hr />
<h3 id="q18-how-do-i-debug-why-a-request-was-denied">Q18: How do I debug why a request was denied?<a class="headerlink" href="#q18-how-do-i-debug-why-a-request-was-denied" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Enable detailed audit logging:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># 1. Check audit log for request</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>curl<span class="w"> </span>http://localhost:8000/api/v1/audit/events<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">  </span>-G<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">  </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;user_id=user_123&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">  </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;decision=deny&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.events[0]&#39;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="c1"># 2. Check OPA policy evaluation</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>opa<span class="w"> </span>opa<span class="w"> </span><span class="nb">eval</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="w">  </span>--data<span class="w"> </span>/policies<span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="w">  </span>--input<span class="w"> </span>&lt;<span class="o">(</span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="s1">    &quot;action&quot;: &quot;gateway:tool:invoke&quot;,</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="s1">    &quot;user&quot;: {&quot;id&quot;: &quot;user_123&quot;, &quot;role&quot;: &quot;viewer&quot;},</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="s1">    &quot;tool&quot;: {&quot;sensitivity_level&quot;: &quot;high&quot;}</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="s1">  }&#39;</span><span class="o">)</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="w">  </span><span class="s1">&#39;data.mcp.gateway.allow&#39;</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="c1"># 3. Enable verbose logging</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>DEBUG
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>restart<span class="w"> </span>sark
</span></code></pre></div>
<p><strong> Debug guide:</strong> <a href="../TROUBLESHOOTING_GUIDE/#debug-mode-and-logging">TROUBLESHOOTING_GUIDE.md</a></p>
<hr />
<h3 id="q19-can-i-batch-authorize-multiple-requests">Q19: Can I batch authorize multiple requests?<a class="headerlink" href="#q19-can-i-batch-authorize-multiple-requests" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Not currently, but you can optimize with caching:</p>
<p><strong>Current approach (N requests):</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">for</span><span class="w"> </span>tool<span class="w"> </span><span class="k">in</span><span class="w"> </span>tool1<span class="w"> </span>tool2<span class="w"> </span>tool3<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/v1/gateway/authorize<span class="w"> </span><span class="se">\</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span>-d<span class="w"> </span><span class="s2">&quot;{\&quot;action\&quot;: \&quot;gateway:tool:invoke\&quot;, \&quot;tool_name\&quot;: \&quot;</span><span class="nv">$tool</span><span class="s2">\&quot;}&quot;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="k">done</span>
</span></code></pre></div></p>
<p><strong>Optimized (cache results):</strong>
- First request: 50ms (policy evaluation)
- Subsequent requests: 5ms (cache hit)
- Cache TTL: 60-300 seconds (configurable)</p>
<p><strong>Future:</strong> Batch authorization API is planned for v1.2.0.</p>
<hr />
<h3 id="q20-how-do-i-rotate-gateway-api-keys">Q20: How do I rotate Gateway API keys?<a class="headerlink" href="#q20-how-do-i-rotate-gateway-api-keys" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use the zero-downtime rotation procedure:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># 1. Generate new key</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nv">NEW_KEY</span><span class="o">=</span><span class="k">$(</span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>sark-app<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>sark.cli<span class="w"> </span>generate-api-key<span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">  </span>--type<span class="w"> </span>gateway<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;gateway-prod-v2&quot;</span><span class="k">)</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="c1"># 2. Configure Gateway to use both old and new keys (dual-key mode)</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c1"># Update Gateway config to accept both keys</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="c1"># 3. Update SARK to return new key</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="nb">export</span><span class="w"> </span><span class="nv">GATEWAY_API_KEY</span><span class="o">=</span><span class="nv">$NEW_KEY</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="c1"># 4. Restart SARK (rolling restart)</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>restart<span class="w"> </span>sark
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="c1"># 5. After 24 hours, remove old key from Gateway</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="c1"># Gateway now only accepts new key</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="c1"># 6. Revoke old key in SARK</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>sark-app<span class="w"> </span>python<span class="w"> </span>-m<span class="w"> </span>sark.cli<span class="w"> </span>revoke-api-key<span class="w"> </span>--key<span class="w"> </span>OLD_KEY
</span></code></pre></div>
<p><strong>Automation:</strong> Set up monthly rotation with monitoring alerts.</p>
<hr />
<h3 id="q21-what-happens-if-opa-is-unavailable">Q21: What happens if OPA is unavailable?<a class="headerlink" href="#q21-what-happens-if-opa-is-unavailable" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> SARK's behavior depends on configuration:</p>
<p><strong>Fail-closed (default, secure):</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nv">OPA_FAIL_CLOSED</span><span class="o">=</span><span class="nb">true</span><span class="w">  </span><span class="c1"># All requests denied if OPA is down</span>
</span></code></pre></div></p>
<p><strong>Fail-open (permissive, risky):</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nv">OPA_FAIL_CLOSED</span><span class="o">=</span><span class="nb">false</span><span class="w">  </span><span class="c1"># Requests allowed if OPA is down</span>
</span></code></pre></div></p>
<p><strong>Recommendation:</strong> Always use fail-closed in production.</p>
<p><strong>Monitoring:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Alert when OPA is unhealthy</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nv">sark_opa_health_status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>
</span></code></pre></div></p>
<hr />
<h2 id="policies-authorization">Policies &amp; Authorization<a class="headerlink" href="#policies-authorization" title="Permanent link">&para;</a></h2>
<h3 id="q22-how-do-i-write-a-custom-gateway-authorization-policy">Q22: How do I write a custom Gateway authorization policy?<a class="headerlink" href="#q22-how-do-i-write-a-custom-gateway-authorization-policy" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Create a new <code>.rego</code> file in <code>opa/policies/</code>:</p>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># opa/policies/custom_gateway.rego</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">package</span><span class="w"> </span><span class="n">mcp</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">custom</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="k">import</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="n">keywords</span><span class="p">.</span><span class="k">if</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="c1"># Allow data scientists to query analytics tools</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="w">    </span><span class="s2">&quot;data-science&quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">teams</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;analytics-mcp&quot;</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">sensitivity_level</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">]</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="p">}</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="c1"># Deny critical database operations after hours</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="n">deny</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;drop_table&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;delete_database&quot;</span><span class="p">]</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="w">    </span><span class="k">not</span><span class="w"> </span><span class="n">is_work_hours</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="p">}</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="n">is_work_hours</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="w">    </span><span class="n">hour</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="n">clock</span><span class="p">([</span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UTC&quot;</span><span class="p">])[</span><span class="m">0</span><span class="p">]</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="w">    </span><span class="n">hour</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">9</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="w">    </span><span class="n">hour</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">17</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Test the policy:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>opa<span class="w"> </span><span class="nb">test</span><span class="w"> </span>opa/policies/custom_gateway_test.rego
</span></code></pre></div></p>
<p><strong>Deploy:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Reload OPA policies</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8181/v1/policies/custom_gateway<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span>--data-binary<span class="w"> </span>@opa/policies/custom_gateway.rego
</span></code></pre></div></p>
<p><strong> Policy guide:</strong> <a href="../../../ADVANCED_OPA_POLICIES/">ADVANCED_OPA_POLICIES.md</a></p>
<hr />
<h3 id="q23-whats-the-difference-between-sark-policies-and-gateway-policies">Q23: What's the difference between SARK policies and Gateway policies?<a class="headerlink" href="#q23-whats-the-difference-between-sark-policies-and-gateway-policies" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> They serve different purposes:</p>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>SARK Policies</th>
<th>Gateway Policies</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Scope</strong></td>
<td>Direct SARK API access</td>
<td>Gateway-routed requests</td>
</tr>
<tr>
<td><strong>Location</strong></td>
<td><code>mcp.allow</code></td>
<td><code>mcp.gateway.allow</code></td>
</tr>
<tr>
<td><strong>Input</strong></td>
<td>SARK request context</td>
<td>Gateway request + metadata</td>
</tr>
<tr>
<td><strong>Use Case</strong></td>
<td>Tool registration, user management</td>
<td>Tool invocation via Gateway</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># SARK policy (direct access)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">package</span><span class="w"> </span><span class="n">mcp</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;tool:invoke&quot;</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="p">}</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="c1"># Gateway policy (via Gateway)</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="k">package</span><span class="w"> </span><span class="n">mcp</span><span class="p">.</span><span class="n">gateway</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="p">}</span>
</span></code></pre></div></p>
<p>Both policies can coexist and are evaluated independently.</p>
<hr />
<h3 id="q24-how-do-i-grant-a-user-access-to-specific-gateway-servers">Q24: How do I grant a user access to specific Gateway servers?<a class="headerlink" href="#q24-how-do-i-grant-a-user-access-to-specific-gateway-servers" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use team-based access control:</p>
<p><strong>1. Add user to team:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/v1/teams/data-science/members<span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">ADMIN_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;user_id&quot;: &quot;user_123&quot;}&#39;</span>
</span></code></pre></div></p>
<p><strong>2. Create policy for team:</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="c1"># Allow data-science team to access specific servers</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="s2">&quot;data-science&quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">teams</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;analytics-mcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ml-mcp&quot;</span><span class="p">]</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>3. Verify access:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/v1/gateway/authorize<span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">USER_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="s1">    &quot;action&quot;: &quot;gateway:tool:invoke&quot;,</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="s1">    &quot;server_name&quot;: &quot;analytics-mcp&quot;</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="s1">  }&#39;</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="c1"># Should return: {&quot;allow&quot;: true}</span>
</span></code></pre></div></p>
<hr />
<h3 id="q25-can-i-filter-sensitive-parameters-in-gateway-requests">Q25: Can I filter sensitive parameters in Gateway requests?<a class="headerlink" href="#q25-can-i-filter-sensitive-parameters-in-gateway-requests" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Yes! Use parameter filtering in OPA policies:</p>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># Filter password from database connection</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">filtered_parameters</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">sanitized</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;db_connect&quot;</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">    </span><span class="n">sanitized</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">object</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">parameters</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;secret&quot;</span><span class="p">])</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>SARK returns filtered parameters:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">  </span><span class="nt">&quot;allow&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">  </span><span class="nt">&quot;filtered_parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="nt">&quot;host&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;db.example.com&quot;</span><span class="p">,</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="nt">&quot;database&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prod&quot;</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span><span class="c1">// &quot;password&quot; removed</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="p">}</span>
</span></code></pre></div></p>
<p>Gateway uses <code>filtered_parameters</code> instead of original request.</p>
<p><strong> Security guide:</strong> <a href="../../../SECURITY_BEST_PRACTICES/">SECURITY_BEST_PRACTICES.md</a></p>
<hr />
<h3 id="q26-how-do-i-implement-time-based-access-restrictions">Q26: How do I implement time-based access restrictions?<a class="headerlink" href="#q26-how-do-i-implement-time-based-access-restrictions" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use OPA's time functions:</p>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">package</span><span class="w"> </span><span class="n">mcp</span><span class="p">.</span><span class="n">gateway</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="k">import</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="n">keywords</span><span class="p">.</span><span class="k">if</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="c1"># Allow only during business hours</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="w">    </span><span class="n">is_business_hours</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">now_ns</span><span class="p">())</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="p">}</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="n">is_business_hours</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="w">    </span><span class="n">hour</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="n">clock</span><span class="p">([</span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;UTC&quot;</span><span class="p">])[</span><span class="m">0</span><span class="p">]</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">    </span><span class="n">weekday</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="n">weekday</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w">    </span><span class="c1"># Monday-Friday, 9 AM - 5 PM UTC</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w">    </span><span class="n">weekday</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Monday&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Tuesday&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Wednesday&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Thursday&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Friday&quot;</span><span class="p">]</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">    </span><span class="n">hour</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">9</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w">    </span><span class="n">hour</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">17</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Test:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># During business hours</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>opa<span class="w"> </span><span class="nb">eval</span><span class="w"> </span>--data<span class="w"> </span>policies/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">  </span><span class="s1">&#39;data.mcp.gateway.is_business_hours(time.now_ns())&#39;</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c1"># Returns: true or false</span>
</span></code></pre></div></p>
<hr />
<h3 id="q27-what-are-sensitivity-levels-and-how-do-they-work">Q27: What are sensitivity levels and how do they work?<a class="headerlink" href="#q27-what-are-sensitivity-levels-and-how-do-they-work" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Sensitivity levels classify tools by risk:</p>
<table>
<thead>
<tr>
<th>Level</th>
<th>Description</th>
<th>Examples</th>
<th>Default Access</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>low</strong></td>
<td>Read-only, safe operations</td>
<td>List files, read logs</td>
<td>All authenticated users</td>
</tr>
<tr>
<td><strong>medium</strong></td>
<td>Write operations, limited scope</td>
<td>Create file, update config</td>
<td>Developers, admins</td>
</tr>
<tr>
<td><strong>high</strong></td>
<td>Sensitive data, system changes</td>
<td>Read database, restart service</td>
<td>Admins only</td>
</tr>
<tr>
<td><strong>critical</strong></td>
<td>Destructive, irreversible</td>
<td>Delete database, format disk</td>
<td>Explicit approval required</td>
</tr>
</tbody>
</table>
<p><strong>Policy example:</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;developer&quot;</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">sensitivity_level</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">]</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="p">}</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">sensitivity_level</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">]</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="p">}</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="c1"># Critical tools require explicit approval</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">sensitivity_level</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;critical&quot;</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">approval_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">    </span><span class="n">is_approved</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">approval_id</span><span class="p">)</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong> Classification guide:</strong> <a href="../../../TOOL_SENSITIVITY_CLASSIFICATION/">TOOL_SENSITIVITY_CLASSIFICATION.md</a></p>
<hr />
<h3 id="q28-how-do-i-handle-a2a-agent-to-agent-authorization">Q28: How do I handle A2A (agent-to-agent) authorization?<a class="headerlink" href="#q28-how-do-i-handle-a2a-agent-to-agent-authorization" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use the dedicated A2A endpoint:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/v1/gateway/authorize-a2a<span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">AGENT_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="s1">    &quot;source_agent_id&quot;: &quot;agent-service-1&quot;,</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="s1">    &quot;target_agent_id&quot;: &quot;agent-worker-2&quot;,</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="s1">    &quot;capability&quot;: &quot;execute&quot;,</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="s1">    &quot;message_type&quot;: &quot;request&quot;</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="s1">  }&#39;</span>
</span></code></pre></div>
<p><strong>Response:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="p">{</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span><span class="nt">&quot;allow&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="nt">&quot;reason&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Trusted service agent can execute on worker agents&quot;</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>A2A Policy:</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">package</span><span class="w"> </span><span class="n">mcp</span><span class="p">.</span><span class="n">gateway</span><span class="p">.</span><span class="n">a2a</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">source_agent</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;service&quot;</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">target_agent</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;worker&quot;</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">capability</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;execute&quot;</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">source_agent</span><span class="p">.</span><span class="n">trust_level</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;trusted&quot;</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong> A2A guide:</strong> See <a href="../../../MCP_GATEWAY_INTEGRATION_PLAN/#agent-to-agent-authorization">MCP_GATEWAY_INTEGRATION_PLAN.md</a></p>
<hr />
<h3 id="q29-can-i-test-policies-without-deploying-to-production">Q29: Can I test policies without deploying to production?<a class="headerlink" href="#q29-can-i-test-policies-without-deploying-to-production" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Yes! Use the OPA testing framework:</p>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># opa/policies/gateway_test.rego</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">package</span><span class="w"> </span><span class="n">mcp</span><span class="p">.</span><span class="n">gateway</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">test_developer_can_invoke_medium_tools</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">    </span><span class="n">allow</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nb">input</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">        </span><span class="s2">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span><span class="p">,</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="w">        </span><span class="s2">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_123&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;developer&quot;</span><span class="p">},</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="w">        </span><span class="s2">&quot;tool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;sensitivity_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;medium&quot;</span><span class="p">}</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="p">}</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="n">test_viewer_cannot_invoke_high_tools</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">    </span><span class="k">not</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nb">input</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">        </span><span class="s2">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span><span class="p">,</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">        </span><span class="s2">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_456&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;viewer&quot;</span><span class="p">},</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">        </span><span class="s2">&quot;tool&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;sensitivity_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">}</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Run tests:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>opa<span class="w"> </span><span class="nb">test</span><span class="w"> </span>opa/policies/<span class="w"> </span>-v
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="c1"># Output:</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="c1"># PASS: 12/12</span>
</span></code></pre></div></p>
<p><strong> Testing guide:</strong> <a href="../../../POLICY_PERFORMANCE_VALIDATION/">POLICY_PERFORMANCE_VALIDATION.md</a></p>
<hr />
<h3 id="q30-how-do-i-implement-rate-limiting-per-user">Q30: How do I implement rate limiting per user?<a class="headerlink" href="#q30-how-do-i-implement-rate-limiting-per-user" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use Redis-backed rate limiting:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># Rate limiting is built into SARK</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="c1"># Configure in .env:</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">RATE_LIMIT_ENABLED</span><span class="o">=</span><span class="n">true</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">RATE_LIMIT_REQUESTS_PER_MINUTE</span><span class="o">=</span><span class="mi">60</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="n">RATE_LIMIT_BURST</span><span class="o">=</span><span class="mi">10</span>
</span></code></pre></div>
<p><strong>Per-user limits in OPA:</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="k">not</span><span class="w"> </span><span class="n">is_rate_limited</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="p">}</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="n">is_rate_limited</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">limited</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">    </span><span class="n">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">&quot;rate_limit:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">user_id</span><span class="p">])</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="w">    </span><span class="n">count</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">redis</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">    </span><span class="n">limited</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">100</span><span class="w">  </span><span class="c1"># Max 100 requests/hour</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Monitor:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># Check rate limit status</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>curl<span class="w"> </span>http://localhost:8000/api/v1/users/user_123/rate-limit
</span></code></pre></div></p>
<hr />
<h3 id="q31-what-happens-when-policies-conflict">Q31: What happens when policies conflict?<a class="headerlink" href="#q31-what-happens-when-policies-conflict" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> OPA uses explicit precedence rules:</p>
<p><strong>Rule 1: Explicit deny wins</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="n">deny</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">tool</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;dangerous_tool&quot;</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="p">}</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="p">}</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="c1"># Result: Denied (explicit deny takes precedence)</span>
</span></code></pre></div></p>
<p><strong>Rule 2: First matching rule (OR logic)</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;developer&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="c1"># Either rule allows access</span>
</span></code></pre></div></p>
<p><strong>Best practice:</strong>
- Use <code>default allow := false</code> for fail-secure
- Write explicit deny rules for sensitive operations
- Test policies with <code>opa test</code></p>
<hr />
<h2 id="performance-scaling">Performance &amp; Scaling<a class="headerlink" href="#performance-scaling" title="Permanent link">&para;</a></h2>
<h3 id="q32-what-is-the-expected-latency-for-authorization-requests">Q32: What is the expected latency for authorization requests?<a class="headerlink" href="#q32-what-is-the-expected-latency-for-authorization-requests" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Latency targets vary by cache state:</p>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>P50</th>
<th>P95</th>
<th>P99</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cache HIT</strong></td>
<td>&lt;5ms</td>
<td>&lt;10ms</td>
<td>&lt;20ms</td>
</tr>
<tr>
<td><strong>Cache MISS</strong></td>
<td>&lt;30ms</td>
<td>&lt;50ms</td>
<td>&lt;100ms</td>
</tr>
<tr>
<td><strong>Cold start</strong></td>
<td>&lt;100ms</td>
<td>&lt;200ms</td>
<td>&lt;500ms</td>
</tr>
</tbody>
</table>
<p><strong>Actual benchmarks</strong> (3-node SARK cluster):
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>Requests: 10,000
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>Duration: 60s
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>RPS: 166
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>Latency Distribution:
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>  P50: 8.2ms
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>  P75: 12.5ms
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>  P90: 28.3ms
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a>  P95: 45.7ms
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>  P99: 89.4ms
</span></code></pre></div></p>
<p><strong> Benchmarks:</strong> <a href="../../../PERFORMANCE_REPORT/">PERFORMANCE_REPORT.md</a></p>
<hr />
<h3 id="q33-how-do-i-optimize-cache-hit-rates">Q33: How do I optimize cache hit rates?<a class="headerlink" href="#q33-how-do-i-optimize-cache-hit-rates" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Increase cache TTL for stable policies:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1"># Default cache TTL by sensitivity</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="nv">GATEWAY_CACHE_TTL_LOW</span><span class="o">=</span><span class="m">300</span><span class="w">      </span><span class="c1"># 5 minutes</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="nv">GATEWAY_CACHE_TTL_MEDIUM</span><span class="o">=</span><span class="m">180</span><span class="w">   </span><span class="c1"># 3 minutes</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="nv">GATEWAY_CACHE_TTL_HIGH</span><span class="o">=</span><span class="m">60</span><span class="w">      </span><span class="c1"># 1 minute</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="nv">GATEWAY_CACHE_TTL_CRITICAL</span><span class="o">=</span><span class="m">30</span><span class="w">  </span><span class="c1"># 30 seconds</span>
</span></code></pre></div>
<p><strong>Monitor cache performance:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># Check cache hit rate</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>curl<span class="w"> </span>http://localhost:8000/api/v1/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>cache_hit_rate
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="c1"># Expected: &gt;90% for production workloads</span>
</span></code></pre></div></p>
<p><strong>Cache invalidation:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># Clear cache after policy update</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/v1/cache/invalidate<span class="w"> </span><span class="se">\</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">ADMIN_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></p>
<p><strong> Caching guide:</strong> See <a href="../PERFORMANCE_TUNING/">PERFORMANCE_TUNING.md</a></p>
<hr />
<h3 id="q34-how-many-requests-per-second-can-sark-handle">Q34: How many requests per second can SARK handle?<a class="headerlink" href="#q34-how-many-requests-per-second-can-sark-handle" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Throughput depends on deployment configuration:</p>
<table>
<thead>
<tr>
<th>Configuration</th>
<th>RPS (P95 &lt;50ms)</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Single instance</strong></td>
<td>~500 RPS</td>
<td>Dev/testing only</td>
</tr>
<tr>
<td><strong>3-node cluster + Redis</strong></td>
<td>~5,000 RPS</td>
<td>Production baseline</td>
</tr>
<tr>
<td><strong>10-node cluster + Redis</strong></td>
<td>~20,000 RPS</td>
<td>High-traffic production</td>
</tr>
<tr>
<td><strong>Kubernetes HPA</strong></td>
<td>~50,000+ RPS</td>
<td>Auto-scaling enabled</td>
</tr>
</tbody>
</table>
<p><strong>Bottlenecks:</strong>
- OPA policy evaluation: ~2-10ms
- Redis cache lookup: ~1-3ms
- PostgreSQL audit log: ~5-15ms (async)</p>
<p><strong>Optimization:</strong>
- Enable Redis caching (10x improvement)
- Use read replicas for PostgreSQL
- Scale OPA horizontally</p>
<hr />
<h3 id="q35-how-do-i-scale-sark-for-high-traffic-gateway-deployments">Q35: How do I scale SARK for high-traffic Gateway deployments?<a class="headerlink" href="#q35-how-do-i-scale-sark-for-high-traffic-gateway-deployments" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use horizontal scaling with load balancing:</p>
<p><strong>Docker Compose:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># Scale SARK to 5 instances</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">sark</span><span class="o">=</span><span class="m">5</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="c1"># Add NGINX load balancer</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>upstream<span class="w"> </span>sark_backend<span class="w"> </span><span class="o">{</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">    </span>least_conn<span class="p">;</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">    </span>server<span class="w"> </span>sark-1:8000<span class="p">;</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">    </span>server<span class="w"> </span>sark-2:8000<span class="p">;</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">    </span>server<span class="w"> </span>sark-3:8000<span class="p">;</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">    </span>server<span class="w"> </span>sark-4:8000<span class="p">;</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">    </span>server<span class="w"> </span>sark-5:8000<span class="p">;</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="o">}</span>
</span></code></pre></div></p>
<p><strong>Kubernetes HPA:</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">autoscaling/v2</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HorizontalPodAutoscaler</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark-gateway-hpa</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">  </span><span class="nt">scaleTargetRef</span><span class="p">:</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark-gateway</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">  </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="w">  </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="w">  </span><span class="nt">metrics</span><span class="p">:</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Resource</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="w">    </span><span class="nt">resource</span><span class="p">:</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cpu</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="w">      </span><span class="nt">target</span><span class="p">:</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Utilization</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="w">        </span><span class="nt">averageUtilization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">70</span>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pods</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="w">    </span><span class="nt">pods</span><span class="p">:</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a><span class="w">      </span><span class="nt">metric</span><span class="p">:</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark_gateway_authz_latency_p95</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="w">      </span><span class="nt">target</span><span class="p">:</span>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AverageValue</span>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="w">        </span><span class="nt">averageValue</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;50m&quot;</span><span class="w">  </span><span class="c1"># 50ms</span>
</span></code></pre></div></p>
<p><strong> Scaling guide:</strong> <a href="../../../PERFORMANCE_OPTIMIZATION/">PERFORMANCE_OPTIMIZATION.md</a></p>
<hr />
<h3 id="q36-should-i-use-redis-cluster-or-redis-sentinel">Q36: Should I use Redis Cluster or Redis Sentinel?<a class="headerlink" href="#q36-should-i-use-redis-cluster-or-redis-sentinel" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Choose based on your requirements:</p>
<p><strong>Redis Cluster (recommended for &gt;100K RPS):</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1"># High throughput, automatic sharding</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="l l-Scalar l-Scalar-Plain">REDIS_MODE=cluster</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="l l-Scalar l-Scalar-Plain">REDIS_CLUSTER_NODES=redis-1:6379,redis-2:6379,redis-3:6379</span>
</span></code></pre></div></p>
<p><strong>Redis Sentinel (recommended for high availability):</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1"># Automatic failover, simpler setup</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="l l-Scalar l-Scalar-Plain">REDIS_MODE=sentinel</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="l l-Scalar l-Scalar-Plain">REDIS_SENTINEL_MASTER=mymaster</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="l l-Scalar l-Scalar-Plain">REDIS_SENTINEL_NODES=sentinel-1:26379,sentinel-2:26379</span>
</span></code></pre></div></p>
<p><strong>Single Redis (dev/small deployments):</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="l l-Scalar l-Scalar-Plain">REDIS_MODE=standalone</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="l l-Scalar l-Scalar-Plain">REDIS_URL=redis://localhost:6379</span>
</span></code></pre></div></p>
<p><strong>Benchmark:</strong> Cluster provides 3-5x throughput of single Redis.</p>
<hr />
<h3 id="q37-how-do-i-reduce-database-load-from-audit-logs">Q37: How do I reduce database load from audit logs?<a class="headerlink" href="#q37-how-do-i-reduce-database-load-from-audit-logs" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use these optimization strategies:</p>
<p><strong>1. Async audit logging (enabled by default):</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1"># Audit writes don&#39;t block authorization responses</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="n">AUDIT_ASYNC_ENABLED</span><span class="o">=</span><span class="n">true</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="n">AUDIT_BATCH_SIZE</span><span class="o">=</span><span class="mi">100</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="n">AUDIT_FLUSH_INTERVAL_SECONDS</span><span class="o">=</span><span class="mi">5</span>
</span></code></pre></div></p>
<p><strong>2. Use TimescaleDB for time-series data:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1">-- Compress old audit logs</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">add_compression_policy</span><span class="p">(</span><span class="s1">&#39;audit_events&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;7 days&#39;</span><span class="p">);</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="c1">-- Automatically archive old data</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">add_retention_policy</span><span class="p">(</span><span class="s1">&#39;audit_events&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;90 days&#39;</span><span class="p">);</span>
</span></code></pre></div></p>
<p><strong>3. Separate read replica for queries:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nv">DATABASE_WRITE_URL</span><span class="o">=</span>postgresql://sark:pass@primary:5432/sark
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="nv">DATABASE_READ_URL</span><span class="o">=</span>postgresql://sark:pass@replica:5432/sark
</span></code></pre></div></p>
<p><strong>Result:</strong> 80% reduction in primary database load.</p>
<p><strong> Database optimization:</strong> <a href="../PERFORMANCE_TUNING/#database-optimization">PERFORMANCE_TUNING.md</a></p>
<hr />
<h3 id="q38-what-are-the-performance-implications-of-complex-opa-policies">Q38: What are the performance implications of complex OPA policies?<a class="headerlink" href="#q38-what-are-the-performance-implications-of-complex-opa-policies" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Policy complexity affects latency:</p>
<table>
<thead>
<tr>
<th>Policy Complexity</th>
<th>Evaluation Time</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Simple</strong> (1-3 conditions)</td>
<td>&lt;1ms</td>
<td>Role check only</td>
</tr>
<tr>
<td><strong>Medium</strong> (5-10 conditions)</td>
<td>2-5ms</td>
<td>Role + team + time check</td>
</tr>
<tr>
<td><strong>Complex</strong> (15+ conditions)</td>
<td>10-30ms</td>
<td>Multiple data lookups, nested rules</td>
</tr>
<tr>
<td><strong>Very Complex</strong> (50+ conditions)</td>
<td>50-100ms+</td>
<td>Recursive rules, external data</td>
</tr>
</tbody>
</table>
<p><strong>Optimization tips:</strong>
- Cache external data lookups
- Use indexed data structures
- Avoid deep recursion
- Profile with <code>opa eval --profile</code></p>
<p><strong>Example profiling:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>opa<span class="w"> </span><span class="nb">eval</span><span class="w"> </span>--profile<span class="w"> </span>--data<span class="w"> </span>policies/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">  </span><span class="s1">&#39;data.mcp.gateway.allow&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">  </span>--input<span class="w"> </span>request.json<span class="w"> </span><span class="se">\</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.profile&#39;</span>
</span></code></pre></div></p>
<hr />
<h3 id="q39-how-do-i-monitor-gateway-integration-performance">Q39: How do I monitor Gateway integration performance?<a class="headerlink" href="#q39-how-do-i-monitor-gateway-integration-performance" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use the built-in Prometheus metrics:</p>
<p><strong>Key metrics:</strong>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="c1"># Authorization latency (P95)</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.95</span><span class="p">,</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">  </span><span class="kr">rate</span><span class="o">(</span><span class="nv">sark_gateway_authz_latency_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="o">)</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="c1"># Cache hit rate</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">sark_gateway_cache_hits_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">/</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">sark_gateway_authz_requests_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="c1"># Error rate</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">sark_gateway_errors_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</span></code></pre></div></p>
<p><strong>Grafana dashboard:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="c1"># Import dashboard</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/dashboards/import<span class="w"> </span><span class="se">\</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="w">  </span>-d<span class="w"> </span>@dashboards/gateway-performance.json
</span></code></pre></div></p>
<p><strong>Alerts:</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1"># High latency alert</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HighGatewayLatency</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="w">  </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">histogram_quantile(0.95, sark_gateway_authz_latency_seconds) &gt; 0.1</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">  </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">    </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Gateway</span><span class="nv"> </span><span class="s">authorization</span><span class="nv"> </span><span class="s">latency</span><span class="nv"> </span><span class="s">&gt;100ms&quot;</span>
</span></code></pre></div></p>
<p><strong> Monitoring:</strong> <a href="../../../MONITORING/">MONITORING.md</a></p>
<hr />
<h3 id="q40-can-i-use-cdn-caching-for-gateway-responses">Q40: Can I use CDN caching for Gateway responses?<a class="headerlink" href="#q40-can-i-use-cdn-caching-for-gateway-responses" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Authorization responses should NOT be cached by CDN:</p>
<p><strong>Why not:</strong>
- Authorization decisions are user-specific
- Cache may serve stale decisions
- Security risk (user A sees user B's permissions)</p>
<p><strong>What you CAN cache:</strong>
- Gateway server list (public data)
- Tool discovery results (with short TTL)
- Static documentation</p>
<p><strong>Use Redis for authorization caching</strong> (user-aware, encrypted).</p>
<hr />
<h2 id="security-authentication">Security &amp; Authentication<a class="headerlink" href="#security-authentication" title="Permanent link">&para;</a></h2>
<h3 id="q41-how-are-gateway-api-keys-secured">Q41: How are Gateway API keys secured?<a class="headerlink" href="#q41-how-are-gateway-api-keys-secured" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Multi-layer security:</p>
<p><strong>Storage:</strong>
- Keys stored as bcrypt hashes in PostgreSQL
- Plain-text keys shown only once at generation
- Encrypted at rest with database encryption</p>
<p><strong>Transmission:</strong>
- TLS 1.3 required for all API calls
- Keys in <code>Authorization: Bearer</code> header (never in URL)</p>
<p><strong>Rotation:</strong>
- 90-day expiration recommended
- Automatic rotation with overlap period
- Audit log tracks all key usage</p>
<p><strong>Monitoring:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1"># Alert on suspicious key usage</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>sark_gateway_api_key_errors_total<span class="w"> </span>&gt;<span class="w"> </span><span class="m">10</span>
</span></code></pre></div></p>
<p><strong> Security guide:</strong> <a href="../../../SECURITY_HARDENING/">SECURITY_HARDENING.md</a></p>
<hr />
<h3 id="q42-what-authentication-methods-are-supported">Q42: What authentication methods are supported?<a class="headerlink" href="#q42-what-authentication-methods-are-supported" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Multiple methods for different use cases:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Use Case</th>
<th>Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>JWT (OIDC)</strong></td>
<td>User authentication</td>
<td><code>AUTH_METHOD=oidc</code></td>
</tr>
<tr>
<td><strong>API Keys</strong></td>
<td>Gateway service auth</td>
<td><code>GATEWAY_API_KEY=...</code></td>
</tr>
<tr>
<td><strong>SAML</strong></td>
<td>Enterprise SSO</td>
<td><code>AUTH_METHOD=saml</code></td>
</tr>
<tr>
<td><strong>LDAP</strong></td>
<td>Legacy systems</td>
<td><code>AUTH_METHOD=ldap</code></td>
</tr>
<tr>
<td><strong>mTLS</strong></td>
<td>Service-to-service</td>
<td>Mutual TLS certificates</td>
</tr>
</tbody>
</table>
<p><strong>Example OIDC config:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="nv">AUTH_METHOD</span><span class="o">=</span>oidc
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="nv">OIDC_PROVIDER_URL</span><span class="o">=</span>https://auth.example.com
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="nv">OIDC_CLIENT_ID</span><span class="o">=</span>sark-gateway
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="nv">OIDC_CLIENT_SECRET</span><span class="o">=</span>secret123
</span></code></pre></div></p>
<p><strong> Auth setup:</strong> <a href="../../../SAML_SETUP/">SAML_SETUP.md</a>, <a href="../../../LDAP_SETUP/">LDAP_SETUP.md</a></p>
<hr />
<h3 id="q43-how-do-i-implement-zero-trust-security-for-gateway-integration">Q43: How do I implement zero-trust security for Gateway integration?<a class="headerlink" href="#q43-how-do-i-implement-zero-trust-security-for-gateway-integration" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Follow these principles:</p>
<p><strong>1. Verify every request:</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="c1"># No implicit trust</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="k">default</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">false</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="c1"># Explicit verification</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">    </span><span class="n">valid_token</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">token</span><span class="p">)</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">    </span><span class="n">authorized_user</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">)</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w">    </span><span class="n">allowed_action</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="p">)</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>2. Mutual TLS between services:</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="c1"># Gateway  SARK: mTLS required</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="l l-Scalar l-Scalar-Plain">GATEWAY_MTLS_ENABLED=true</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="l l-Scalar l-Scalar-Plain">GATEWAY_CLIENT_CERT=/certs/gateway-client.pem</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="l l-Scalar l-Scalar-Plain">GATEWAY_CLIENT_KEY=/certs/gateway-client-key.pem</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="l l-Scalar l-Scalar-Plain">GATEWAY_CA_CERT=/certs/ca.pem</span>
</span></code></pre></div></p>
<p><strong>3. Network segmentation:</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1"># Kubernetes NetworkPolicy</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark-gateway-ingress</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="w">          </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gateway</span>
</span></code></pre></div></p>
<p><strong>4. Audit everything:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="nv">AUDIT_ALL_REQUESTS</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="nv">SIEM_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></div></p>
<p><strong> Zero-trust guide:</strong> <a href="../../../SECURITY_BEST_PRACTICES/#zero-trust-architecture">SECURITY_BEST_PRACTICES.md</a></p>
<hr />
<h3 id="q44-how-are-secrets-managed-in-gateway-integration">Q44: How are secrets managed in Gateway integration?<a class="headerlink" href="#q44-how-are-secrets-managed-in-gateway-integration" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use external secret management:</p>
<p><strong>Kubernetes Secrets (basic):</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark-gateway-secret</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="nt">stringData</span><span class="p">:</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">  </span><span class="nt">GATEWAY_API_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gw_sk_...&quot;</span>
</span></code></pre></div></p>
<p><strong>HashiCorp Vault (recommended):</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1"># Store in Vault</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a>vault<span class="w"> </span>kv<span class="w"> </span>put<span class="w"> </span>secret/sark/gateway<span class="w"> </span><span class="se">\</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">  </span><span class="nv">api_key</span><span class="o">=</span><span class="s2">&quot;gw_sk_...&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">  </span><span class="nv">opa_secret</span><span class="o">=</span><span class="s2">&quot;...&quot;</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="c1"># SARK reads from Vault</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="nv">VAULT_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="nv">VAULT_ADDR</span><span class="o">=</span>https://vault.example.com
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="nv">VAULT_PATH</span><span class="o">=</span>secret/sark/gateway
</span></code></pre></div></p>
<p><strong>AWS Secrets Manager:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="nv">AWS_SECRETS_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="nv">AWS_SECRET_NAME</span><span class="o">=</span>sark/gateway/prod
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="nv">AWS_REGION</span><span class="o">=</span>us-east-1
</span></code></pre></div></p>
<p><strong>Never:</strong>
- Commit secrets to Git
- Log secrets
- Return secrets in API responses</p>
<hr />
<h3 id="q45-what-security-headers-should-be-configured">Q45: What security headers should be configured?<a class="headerlink" href="#q45-what-security-headers-should-be-configured" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Essential security headers:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="c1"># Configured in SARK API</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="n">SECURE_HEADERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>    <span class="s2">&quot;Strict-Transport-Security&quot;</span><span class="p">:</span> <span class="s2">&quot;max-age=31536000; includeSubDomains&quot;</span><span class="p">,</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>    <span class="s2">&quot;X-Content-Type-Options&quot;</span><span class="p">:</span> <span class="s2">&quot;nosniff&quot;</span><span class="p">,</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a>    <span class="s2">&quot;X-Frame-Options&quot;</span><span class="p">:</span> <span class="s2">&quot;DENY&quot;</span><span class="p">,</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>    <span class="s2">&quot;X-XSS-Protection&quot;</span><span class="p">:</span> <span class="s2">&quot;1; mode=block&quot;</span><span class="p">,</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>    <span class="s2">&quot;Content-Security-Policy&quot;</span><span class="p">:</span> <span class="s2">&quot;default-src &#39;self&#39;&quot;</span><span class="p">,</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>    <span class="s2">&quot;Referrer-Policy&quot;</span><span class="p">:</span> <span class="s2">&quot;strict-origin-when-cross-origin&quot;</span><span class="p">,</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Test headers:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>curl<span class="w"> </span>-I<span class="w"> </span>http://localhost:8000/api/v1/gateway/authorize<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;^(Strict|X-|Content-Security)&quot;</span>
</span></code></pre></div></p>
<p><strong>Security scan:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="c1"># Mozilla Observatory</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a>https://observatory.mozilla.org/analyze/your-sark-domain.com
</span></code></pre></div></p>
<hr />
<h3 id="q46-how-do-i-prevent-replay-attacks">Q46: How do I prevent replay attacks?<a class="headerlink" href="#q46-how-do-i-prevent-replay-attacks" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use nonce and timestamp validation:</p>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1"># OPA policy with replay prevention</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">    </span><span class="c1"># Validate timestamp (5 minutes)</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">    </span><span class="n">timestamp_valid</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="w">    </span><span class="c1"># Validate nonce (single use)</span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="w">    </span><span class="n">nonce_fresh</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">nonce</span><span class="p">)</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">    </span><span class="c1"># Standard authorization</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">    </span><span class="n">authorized_user</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">user</span><span class="p">)</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="p">}</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="n">timestamp_valid</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="w">    </span><span class="n">now</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="n">now_ns</span><span class="p">()</span>
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a><span class="w">    </span><span class="n">diff</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ts</span><span class="p">)</span>
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#__codelineno-75-18"></a><span class="w">    </span><span class="n">diff</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">300000000000</span><span class="w">  </span><span class="c1"># 5 minutes in nanoseconds</span>
</span><span id="__span-75-19"><a id="__codelineno-75-19" name="__codelineno-75-19" href="#__codelineno-75-19"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Gateway implementation:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="c1"># Gateway adds metadata</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="n">request_metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">),</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>    <span class="s2">&quot;nonce&quot;</span><span class="p">:</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>    <span class="s2">&quot;request_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="p">}</span>
</span></code></pre></div></p>
<hr />
<h3 id="q47-how-are-audit-logs-protected-from-tampering">Q47: How are audit logs protected from tampering?<a class="headerlink" href="#q47-how-are-audit-logs-protected-from-tampering" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Multiple protection layers:</p>
<p><strong>1. Immutable database columns:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">audit_events</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w">    </span><span class="k">timestamp</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">    </span><span class="n">event_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="w">    </span><span class="n">decision</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">    </span><span class="c1">-- Immutable: INSERT only, no UPDATE/DELETE</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="p">);</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="c1">-- Prevent updates</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TRIGGER</span><span class="w"> </span><span class="n">prevent_audit_update</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="k">BEFORE</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">audit_events</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="k">FOR</span><span class="w"> </span><span class="k">EACH</span><span class="w"> </span><span class="k">ROW</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="k">EXECUTE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">prevent_update</span><span class="p">();</span>
</span></code></pre></div></p>
<p><strong>2. Cryptographic signatures:</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="c1"># Each audit event is signed</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="n">audit_event</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;aud_123&quot;</span><span class="p">,</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;2025-11-28T10:00:00Z&quot;</span><span class="p">,</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>    <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;gateway:tool:invoke&quot;</span><span class="p">,</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a>    <span class="s2">&quot;signature&quot;</span><span class="p">:</span> <span class="n">hmac_sha256</span><span class="p">(</span><span class="n">event_data</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">)</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>3. External SIEM forwarding:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1"># Real-time copy to Splunk/Datadog</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="nv">SIEM_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="nv">SIEM_PROVIDER</span><span class="o">=</span>splunk
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="nv">SIEM_HEC_URL</span><span class="o">=</span>https://splunk.example.com:8088
</span></code></pre></div></p>
<p><strong>4. Blockchain audit trail (optional):</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="c1"># Tamper-proof blockchain</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="nv">BLOCKCHAIN_AUDIT_ENABLED</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="nv">BLOCKCHAIN_PROVIDER</span><span class="o">=</span>hyperledger
</span></code></pre></div></p>
<p><strong>Verification:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1"># Verify audit log integrity</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a>python<span class="w"> </span>-m<span class="w"> </span>sark.cli<span class="w"> </span>verify-audit-logs<span class="w"> </span>--start-date<span class="w"> </span><span class="m">2025</span>-11-01
</span></code></pre></div></p>
<hr />
<h3 id="q48-what-compliance-standards-does-gateway-integration-support">Q48: What compliance standards does Gateway integration support?<a class="headerlink" href="#q48-what-compliance-standards-does-gateway-integration-support" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> SARK Gateway integration supports:</p>
<table>
<thead>
<tr>
<th>Standard</th>
<th>Features</th>
<th>Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SOC 2</strong></td>
<td>Audit logs, access control, encryption</td>
<td>Compliance report available</td>
</tr>
<tr>
<td><strong>HIPAA</strong></td>
<td>PHI protection, audit trails, encryption at rest</td>
<td><a href="../../../SECURITY_HARDENING/">SECURITY_HARDENING.md</a></td>
</tr>
<tr>
<td><strong>GDPR</strong></td>
<td>Data privacy, right to erasure, audit logs</td>
<td><a href="../../GDPR_COMPLIANCE.md">GDPR_COMPLIANCE.md</a></td>
</tr>
<tr>
<td><strong>PCI-DSS</strong></td>
<td>Encryption, access controls, logging</td>
<td>Contact for questionnaire</td>
</tr>
<tr>
<td><strong>ISO 27001</strong></td>
<td>ISMS controls, risk management</td>
<td><a href="../../ISO_27001_CONTROLS.md">ISO_27001_CONTROLS.md</a></td>
</tr>
</tbody>
</table>
<p><strong>Compliance features:</strong>
- Full audit trail of all access
- Encryption in transit (TLS 1.3) and at rest
- Role-based access control (RBAC)
- Data retention policies
- Incident response procedures</p>
<hr />
<h3 id="q49-how-do-i-implement-ip-allowlisting-for-gateway">Q49: How do I implement IP allowlisting for Gateway?<a class="headerlink" href="#q49-how-do-i-implement-ip-allowlisting-for-gateway" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Use network policies and OPA rules:</p>
<p><strong>OPA policy:</strong>
<div class="language-rego highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="k">package</span><span class="w"> </span><span class="n">mcp</span><span class="p">.</span><span class="n">gateway</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="c1"># Allow only from trusted IP ranges</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="n">allow</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="w">    </span><span class="n">ip_allowed</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">client_ip</span><span class="p">)</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="p">}</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="n">ip_allowed</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="w">    </span><span class="c1"># Office network</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a><span class="w">    </span><span class="n">net</span><span class="p">.</span><span class="n">cidr_contains</span><span class="p">(</span><span class="s2">&quot;10.0.0.0/8&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ip</span><span class="p">)</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a><span class="p">}</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a><span class="n">ip_allowed</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a><span class="w">    </span><span class="c1"># VPN endpoints</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16" href="#__codelineno-82-16"></a><span class="w">    </span><span class="n">ip</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;203.0.113.50&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;203.0.113.51&quot;</span><span class="p">]</span>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17" href="#__codelineno-82-17"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Kubernetes NetworkPolicy:</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark-ip-allowlist</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="w">        </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.0.0.0/8</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">        </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">203.0.113.0/24</span>
</span></code></pre></div></p>
<hr />
<h3 id="q50-how-do-i-audit-who-accessed-sensitive-data">Q50: How do I audit who accessed sensitive data?<a class="headerlink" href="#q50-how-do-i-audit-who-accessed-sensitive-data" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Query the audit log with filters:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1">-- All access to sensitive tools in the last 24 hours</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="k">SELECT</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w">    </span><span class="k">timestamp</span><span class="p">,</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">    </span><span class="n">user_id</span><span class="p">,</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w">    </span><span class="n">metadata</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;server_name&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">server</span><span class="p">,</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w">    </span><span class="n">metadata</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;tool_name&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tool</span><span class="p">,</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="w">    </span><span class="n">decision</span><span class="p">,</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="w">    </span><span class="n">metadata</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;sensitivity_level&#39;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sensitivity</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="k">FROM</span><span class="w"> </span><span class="n">audit_events</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="k">WHERE</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="w">    </span><span class="n">event_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;gateway:tool:invoke&#39;</span>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">metadata</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;sensitivity_level&#39;</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">)</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;24 hours&#39;</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<p><strong>API query:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>curl<span class="w"> </span>http://localhost:8000/api/v1/audit/events<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">ADMIN_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="w">  </span>-G<span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="w">  </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;event_type=gateway:tool:invoke&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="w">  </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;sensitivity_level=high,critical&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="w">  </span>--data-urlencode<span class="w"> </span><span class="s2">&quot;since=24h&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.events[] | {user: .user_id, tool: .metadata.tool_name, time: .timestamp}&#39;</span>
</span></code></pre></div></p>
<p><strong>Export for compliance:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="c1"># Generate compliance report</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>python<span class="w"> </span>-m<span class="w"> </span>sark.cli<span class="w"> </span>generate-compliance-report<span class="w"> </span><span class="se">\</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">  </span>--start-date<span class="w"> </span><span class="m">2025</span>-11-01<span class="w"> </span><span class="se">\</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">  </span>--end-date<span class="w"> </span><span class="m">2025</span>-11-30<span class="w"> </span><span class="se">\</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">  </span>--format<span class="w"> </span>pdf<span class="w"> </span><span class="se">\</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">  </span>--output<span class="w"> </span>compliance-november-2025.pdf
</span></code></pre></div></p>
<hr />
<h2 id="integration-compatibility">Integration &amp; Compatibility<a class="headerlink" href="#integration-compatibility" title="Permanent link">&para;</a></h2>
<h3 id="q51-is-gateway-integration-compatible-with-existing-mcp-servers">Q51: Is Gateway integration compatible with existing MCP servers?<a class="headerlink" href="#q51-is-gateway-integration-compatible-with-existing-mcp-servers" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Yes, 100% compatible! No server modifications needed.</p>
<p><strong>Why it works:</strong>
- Authorization happens at Gateway layer
- MCP servers receive standard MCP protocol requests
- SARK is transparent to servers</p>
<p><strong>Supported MCP versions:</strong>
- MCP Protocol: v1.0.0+
- All transport types: stdio, SSE, HTTP</p>
<hr />
<h3 id="q52-can-i-use-gateway-integration-with-claude-desktop">Q52: Can I use Gateway integration with Claude Desktop?<a class="headerlink" href="#q52-can-i-use-gateway-integration-with-claude-desktop" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Not directly. Claude Desktop connects to local MCP servers.</p>
<p><strong>Workaround:</strong>
1. Run local Gateway instance
2. Configure Claude Desktop to connect to Gateway
3. Gateway routes through SARK for authorization</p>
<p><strong>Configuration:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="p">{</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">    </span><span class="nt">&quot;gateway&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;npx&quot;</span><span class="p">,</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;-y&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/gateway-client&quot;</span><span class="p">],</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">        </span><span class="nt">&quot;GATEWAY_URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://localhost:8080&quot;</span><span class="p">,</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">        </span><span class="nt">&quot;SARK_TOKEN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your-token&quot;</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Better approach:</strong> Use SARK for server-side MCP deployments.</p>
<hr />
<h3 id="q53-does-gateway-integration-work-with-kubernetes-ingress">Q53: Does Gateway integration work with Kubernetes Ingress?<a class="headerlink" href="#q53-does-gateway-integration-work-with-kubernetes-ingress" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Yes, with proper configuration:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark-gateway-ingress</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-read-timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30&quot;</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark.example.com</span>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a><span class="w">    </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark-tls</span>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark.example.com</span>
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a><span class="w">    </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a><span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/api/v1/gateway</span>
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-88-19"><a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a><span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-88-20"><a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a><span class="w">          </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-88-21"><a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sark-gateway</span>
</span><span id="__span-88-22"><a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a><span class="w">            </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-88-23"><a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span>
</span></code></pre></div>
<p><strong>Test:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>curl<span class="w"> </span>https://sark.example.com/api/v1/gateway/health
</span></code></pre></div></p>
<hr />
<h2 id="troubleshooting-debugging">Troubleshooting &amp; Debugging<a class="headerlink" href="#troubleshooting-debugging" title="Permanent link">&para;</a></h2>
<h3 id="q54-why-are-my-authorization-requests-timing-out">Q54: Why are my authorization requests timing out?<a class="headerlink" href="#q54-why-are-my-authorization-requests-timing-out" title="Permanent link">&para;</a></h3>
<p><strong>Common causes and solutions in order of likelihood:</strong></p>
<ol>
<li><strong>OPA slow/unavailable</strong>  Check <code>docker logs opa</code></li>
<li><strong>Database connection pool exhausted</strong>  Increase pool size</li>
<li><strong>Redis connection issues</strong>  Check <code>redis-cli ping</code></li>
<li><strong>Network latency</strong>  Measure with <code>curl -w "@curl-format.txt"</code></li>
</ol>
<p><strong>Quick diagnosis:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>curl<span class="w"> </span>-w<span class="w"> </span><span class="s2">&quot;time_total: %{time_total}s\n&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">  </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/v1/gateway/authorize<span class="w"> </span><span class="se">\</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;action&quot;: &quot;gateway:tool:invoke&quot;}&#39;</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="c1"># If &gt;1s, check component latency:</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a>curl<span class="w"> </span>http://localhost:8000/health/detailed<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.dependencies&#39;</span>
</span></code></pre></div></p>
<p><strong> See:</strong> <a href="../TROUBLESHOOTING_GUIDE/#request-timeouts">TROUBLESHOOTING_GUIDE.md</a></p>
<hr />
<h3 id="q55-how-do-i-enable-debug-logging">Q55: How do I enable debug logging?<a class="headerlink" href="#q55-how-do-i-enable-debug-logging" title="Permanent link">&para;</a></h3>
<p><strong>A:</strong> Set log level to DEBUG:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c1"># Environment variable</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">LOG_LEVEL</span><span class="o">=</span>DEBUG
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="c1"># Restart SARK</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a>docker<span class="w"> </span>compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.gateway.yml<span class="w"> </span>restart<span class="w"> </span>sark
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="c1"># View logs</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>sark<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>gateway
</span></code></pre></div>
<p><strong>Structured logging output:</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="p">{</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-28T10:00:00Z&quot;</span><span class="p">,</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="w">  </span><span class="nt">&quot;logger&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sark.gateway.authorize&quot;</span><span class="p">,</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Evaluating authorization request&quot;</span><span class="p">,</span>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="w">  </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user_123&quot;</span><span class="p">,</span>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="w">  </span><span class="nt">&quot;action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;gateway:tool:invoke&quot;</span><span class="p">,</span>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w">  </span><span class="nt">&quot;server&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;postgres-mcp&quot;</span><span class="p">,</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w">  </span><span class="nt">&quot;duration_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">45.2</span>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong> Debug guide:</strong> <a href="../TROUBLESHOOTING_GUIDE/#debug-mode-and-logging">TROUBLESHOOTING_GUIDE.md</a></p>
<hr />
<h3 id="q56-where-can-i-find-help-and-support">Q56: Where can I find help and support?<a class="headerlink" href="#q56-where-can-i-find-help-and-support" title="Permanent link">&para;</a></h3>
<p><strong>Documentation:</strong>
- <a href="../TROUBLESHOOTING_GUIDE/">Troubleshooting Guide</a>
- <a href="../../../OPERATIONS_RUNBOOK/">Operations Runbook</a>
- <a href="../../../API_REFERENCE/">API Reference</a></p>
<p><strong>Community:</strong>
- GitHub Discussions: https://github.com/your-org/sark/discussions
- Slack Channel: #sark-support
- Stack Overflow: Tag <code>sark-gateway</code></p>
<p><strong>Enterprise Support:</strong>
- Email: support@example.com
- Support Portal: https://support.example.com
- SLA: 4-hour response for P1 issues</p>
<p><strong>Bug Reports:</strong>
- GitHub Issues: https://github.com/your-org/sark/issues
- Use template: <a href="../TROUBLESHOOTING_GUIDE/#bug-report-template">Bug Report Template</a></p>
<hr />
<h2 id="additional-resources">Additional Resources<a class="headerlink" href="#additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="../TROUBLESHOOTING_GUIDE/">TROUBLESHOOTING_GUIDE.md</a></strong> - Comprehensive troubleshooting procedures</li>
<li><strong><a href="../ERROR_REFERENCE/">ERROR_REFERENCE.md</a></strong> - Complete error code catalog</li>
<li><strong><a href="../PERFORMANCE_TUNING/">PERFORMANCE_TUNING.md</a></strong> - Performance optimization guide</li>
<li><strong><a href="../../../MCP_GATEWAY_INTEGRATION_PLAN/">MCP_GATEWAY_INTEGRATION_PLAN.md</a></strong> - Integration architecture</li>
<li><strong><a href="../../../OPERATIONS_RUNBOOK/">OPERATIONS_RUNBOOK.md</a></strong> - Operational procedures</li>
<li><strong><a href="../../../SECURITY_BEST_PRACTICES/">SECURITY_BEST_PRACTICES.md</a></strong> - Security hardening</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: November 2025 | <strong>Version</strong>: 1.1.0
<strong>Questions or feedback?</strong> Open an issue or contact support@example.com</p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 James Henry. All rights reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/apathy-ca/sark" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link", "toc.follow"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>