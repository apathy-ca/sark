# ============================================================================
# SARK UI - SSL/TLS Configuration
# ============================================================================
# Modern SSL/TLS configuration for production deployments
# Based on Mozilla SSL Configuration Generator (Intermediate profile)
# Reference: https://ssl-config.mozilla.org/
# ============================================================================

# SSL protocols
# Only allow TLS 1.2 and 1.3 (disable older insecure protocols)
ssl_protocols TLSv1.2 TLSv1.3;

# SSL ciphers
# Prefer server ciphers over client ciphers
ssl_prefer_server_ciphers off;

# Modern cipher suite (compatible with most clients)
ssl_ciphers 'ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384';

# DH parameters for DHE ciphersuites (2048-bit)
# Generate with: openssl dhparam -out /etc/nginx/ssl/dhparam.pem 2048
ssl_dhparam /etc/nginx/ssl/dhparam.pem;

# SSL session cache and timeout
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 1d;
ssl_session_tickets off;

# OCSP stapling
# Fetch OCSP records from CA and cache them
ssl_stapling on;
ssl_stapling_verify on;
ssl_trusted_certificate /etc/nginx/ssl/chain.pem;

# DNS resolver for OCSP stapling
# Use your organization's DNS servers or public DNS
resolver 8.8.8.8 8.8.4.4 valid=300s;
resolver_timeout 5s;

# Buffer size for SSL operations
ssl_buffer_size 4k;

# ============================================================================
# Let's Encrypt Configuration (if using certbot)
# ============================================================================
# Uncomment if using Let's Encrypt for SSL certificates
#
# ssl_certificate /etc/letsencrypt/live/sark.example.com/fullchain.pem;
# ssl_certificate_key /etc/letsencrypt/live/sark.example.com/privkey.pem;
# ssl_trusted_certificate /etc/letsencrypt/live/sark.example.com/chain.pem;

# ============================================================================
# Custom Certificate Configuration
# ============================================================================
# If using custom certificates, specify paths here
# These should be mounted as Docker volumes or Kubernetes secrets
#
# ssl_certificate /etc/nginx/ssl/cert.pem;
# ssl_certificate_key /etc/nginx/ssl/key.pem;
# ssl_trusted_certificate /etc/nginx/ssl/chain.pem;

# ============================================================================
# TLS 1.3 Early Data (0-RTT)
# ============================================================================
# Enable TLS 1.3 0-RTT for improved performance
# WARNING: Only enable for idempotent requests (GET, HEAD)
# ssl_early_data on;
#
# Protect against replay attacks
# proxy_set_header Early-Data $ssl_early_data;

# ============================================================================
# HTTP/2 Configuration
# ============================================================================
# HTTP/2 is enabled in the server block with: listen 443 ssl http2;
# No additional configuration needed here

# ============================================================================
# Certificate Transparency
# ============================================================================
# Include SCTs in the handshake for Certificate Transparency
# This improves security and is required for some browsers
# ssl_ct on;
# ssl_ct_static_scts /path/to/scts;

# ============================================================================
# Testing SSL Configuration
# ============================================================================
#
# Test your SSL configuration with:
#   1. SSL Labs: https://www.ssllabs.com/ssltest/
#   2. Mozilla Observatory: https://observatory.mozilla.org/
#   3. OpenSSL: openssl s_client -connect sark.example.com:443
#
# Expected SSL Labs grade: A or A+
#
# ============================================================================
